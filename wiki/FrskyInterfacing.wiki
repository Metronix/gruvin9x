#summary Fr-Sky Interfacing
= Fr-Sky Interfacing =

Gruvin (more or less) followed the original TH/ER9X 'JETI' wiring instructions to get RS-232 (TTL level) TX and RX signal for my Fr-Sky two-way transmitter module. Those instructions can be found [http://code.google.com/p/er9x/wiki/JETI here].

Below, you'll find similar and extra detail of exactly how I hooked up my Fr-Sky unit.

== Accessing TXD and RXD on the ATmega ==

The ATmega RXD and TXD special-purpose pins are used for simple switch inputs in the factory '9X -- namely, Throttle-Cut and Aileron-D/R, respectively. 

To free these pins of for serial data, we need to move those two switches elsewhere. The two pins chosen for their new home were pins 41 and 42, or PC6 and PC7 respectively.

The modification requires the use of FINE wire. I used 0.2mm enabled copper wire. You can also use insulated wires salvaged from the newer (but old now) high-density IDE cables used for (ancient) computer hard drives. This is a single-core, insulated wire. You do NOT want to try and use any kind of multi-strand wire -- no matter how fine it it is.

=== Re-wiring Procedure ===

Referring to the image below ...

 * Remove the two left-hand-most resistors as indicated in yellow
 * Hot glue a couple of 220ohm resistors (1/8th or 1/4watt are OK) to a nearby, clearish area of the PCB
 * Solder your 'super fine' wires to pins 41 and 42 of the ATmega and connect to the top end of the resistors as shown. Use alcohol if required -- to steady your hands! (Just joking -- but if it works for you -- go right ahead. :p)
 _HINT: Pre-solder the wire end and the ATmega pins. Use a solder sucker or de-soldering wick to clear away excess solder from the two pins and to remove any solder bridge. Then lay the first wire end over the pin and apply the soldering iron directly down on top of it for half a second, then directly straight up -- then let go the wire. Give the wire a gentle tug in the direction directly away from the chip (in line with the pin).If it holds -- you're done. Don't futz with it. If you're right handed, solder the left hand wire first, so the the soldering iron does not lay over the first wire when trying to solder the second._
 * Solder wires from the bottom ends of the hot-glued resistors to the little vias (holes) near where the two removed resistors were, as shown in the image.

 [http://gruvin9x.googlecode.com/svn/wiki/FrskyInterfacing.attach/frsky-wiring.jpg]


*NOTE:* It pays to use small dabs of hot-glue near the ATmega pins and in a couple of places along the wires to hold them in place. The last thing you want is for something to get hooked under them and rip them off, possibly damaging the ATmega pins in the process!

== The Interface ==

Fr-Sky, in their wisdom, decided to use RS-232 voltage levels for their interface, rather than provide a more modern 5V TTL-to-serial USB interface. We tried to talk them out of it, but they stuck to their guns. Oh well.

What this means is that you need to invert and voltage-shift the signals to and from the Fr-Sky transmitter module, in order to make them play nice with the 5V ATmega. There are specialised chips to do this "properly" -- that is, convert the RS-232 +/-12V to TTL 0-and-5V signals -- but there're simple and in fact advantageous 'hack' methods too. The latter is what Gruvin used.

Advantageous? Well actually, yes. The method shown below allows the transmitter module to still operate when connected to an external serial interface, say on a computer -- while not having to disconnect the internal wiring to the '9X. With the values shown, most computers will take precedence over the internal 9X ATmega micro in terms of sending (transmitting) data to the Fr-Sky module. More useful even, is that you don't have to disconnect the telemetry interface for re-Flashing, either. Clever huh? :p

Here is the circuit ...

 [http://gruvin9x.googlecode.com/svn/wiki/FrskyInterfacing.attach/frsky-interface.png]<br/>
*NOTE* An earlier version of the above circuit had the collector and emitter of Q3 reversed. The circuit as shown here now is correct. (This circuit is clipped from the full schematic of the gruvin9x [CustomPCB custom controller board].)

Any general purpose NPN and PNP transistors should work for the components marked Q2 and Q3, respectively. The BC847/857 devices are in fact SMD surface mount versions, as used in the new PCB design we're working on.

For the prototype, Gruvin actually used a dremel too to carve up the mostly unused, legacy PCB mounted inside the '9X rear casing to build the above circuit 'dead bug' style. (A photo is not presently available.)

== Ground Loops ==

Gruvin found that the Fr-Sky module refused to operate correctly if a ground (GND) wire was connected between the Fr-Sky module's rear RX/TX/GND pins and the level-shifting circuit above. It was assumed that the problem was RF pick-up through the ground-loop created by having two ground wires -- one where the module plugs into the 9X and the other from the serial data port. *Solution:* simply do not connect the ground wire as shown as pin-1 on the connector-K2 in the circuit above.
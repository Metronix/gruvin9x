#summary Custom PCB
#labels Phase-Implementation,Phase-Design
= Custom Main Board Design =

A PCB design has been worked up from scratch in KiCAD to replicate the wiring and function of the V2 '9X hardware. It's closely based on the layout of the original PCB -- especially in terms of component placement. See [http://code.google.com/p/gruvin9x/source/browse/#svn/trunk/pcb/original /trunk/pcb/original/] (as of r155).

== Why? ==

The intention is to (at least) free up more I/O ports on the ATmega64 (nearly all of Port B in fact!). The main reason for this is to provide easy access to USART0 for telemetry data and dedicated access to MISO/MOSI/SCK for MMC/SDCARD interfacing.

== Progress ==

2010-12-22: [http://gruvin9x.googlecode.com/svn/trunk/pcb/rev2.14-frozen/production/gruvin9x-bom.xls  Components] to build three prototypes ordered from Digikey.com

2010-12-15: A first batch of prototype PCB's ([http://gruvin9x.googlecode.com/svn/trunk/pcb/rev2.14-frozen rev2.14]) has been ordered for manufacturing.

== Schematics ==

=== PostScript and PDF Files ===

 * New gruvin9x custom Main PCB rev2.14 (production frozen) - [http://gruvin9x.googlecode.com/svn/trunk/pcb/rev2.14-frozen/gruvin9x.pdf PDF] | [http://gruvin9x.googlecode.com/svn/trunk/pcb/rev2.14-frozen/gruvin9x.ps PS]
 * Stock V2 Main PCB - [http://gruvin9x.googlecode.com/svn/trunk/pcb/actual_v2_9x/gruvin9x_v2_actual.pdf PDF] | [http://gruvin9x.googlecode.com/svn/trunk/pcb/actual_v2_9x/gruvin9x_v2_actual.ps PS]
 * Hacked V2 Main PCB - [http://gruvin9x.googlecode.com/svn/trunk/pcb/hacked/gruvin9x-hacked.pdf PDF] | [http://gruvin9x.googlecode.com/svn/trunk/pcb/hacked/gruvin9x-hacked.ps PS] (Speaker, Fr-Sky telemetry RXD and USART1 freed - hacked unit IE. not a new PCB.)


== KiCAD Circuit Schematic and PCB Files ==

Ongoing circuit/PCB work (snapshots as and when uploaded) reside at [http://code.google.com/p/gruvin9x/source/browse/#svn/trunk/pcb/original /trunk/pcb/]

To download all the PCB design related files only (without project source, docs, etc) ...

{{{
svn checkout http://gruvin9x.googlecode.com/svn/trunk/pcb gruvin9x-pcb
}}}

... or just check out or update the full trunk

... or of course you can use the Google Code 'browse' link above to find them that way.

== Preview ==

2010-12-02: A final draft of the PCB based on [http://gruvin9x.googlecode.com/svn/trunk/pcb/rev2.1/gruvin9x_rev21.pdf schematic rev2.1] has been completed. (All files updated in `/trunk/pcb` as at r159). I'm waiting on some peer review and comments before committing this to a manufacturer. Time frame unknown.

The board includes the total re-wire of all trim and button switches into a 4x4 scanned matrix to free up most of Port B. This gives us dedicated I/O ports for the MMC/SDCARD and a couple spares as well -- with theoretically only very minor CPU load for scanning the inputs. 

The connector for the MMC/SDCARD interface can be seen at lower/middle of the image below. The two connectors to the lower right are the TTL and RS-232 level telemetry TX/RX ports. A 2-pin connector on the upper edge is for the left-hand and right-hand trim switch 'common' connections. These replace their respective connections to ground, in order to work with the new 4x4 input matrix.

This new main board will receive an *ATmega2561* (256K Flash, 4K EEPROM, 8K SRAM). I have thus far decided to keep ATmega running at 5V, though it's certainly tempting to move down to 3.3V, since the LCD screen and SDCARD currently need a total of 31 resistors just to down-convert the voltage! However, I'm concerned about possible noise increase on the ADC inputs, should the operating voltage be lowered, and a couple of other minor issues too. So at 5 Volts we stay.

*The 3D image from KiCAD* as at r155 ...

[http://gruvin9x.googlecode.com/svn/wiki/PCB.attach/kicad-pcb-r21-3d-top.jpg]

NOTE: Since moved on to rev2.11 with a few minor changes/additions, like RF decoupling caps on the KEYXn inputs and some tidying up here and there. Work continues! :-D 


=== Previously ===

NOTE: These images (below) as at r122 ...

[http://gruvin9x.googlecode.com/svn/wiki/PCB.attach/PCB-final-mock.jpg]

The above image is merely a PhotoShop mock-up based on the various layer outputs from KiCAD. 

=== Cost ===

The present best quote for low volume PCB manufacture is around the USD$15 mark -- for one of 10 boards with no components installed. Manufacturing of a prototype board will likely not happen until at least the telemetry and mass storage mods have been done. That will include break-outs for any remaining spare port pins and should get the hardware to a point where nothing additional is needed. 

[http://gruvin9x.googlecode.com/svn/wiki/PCB.attach/kicad-pcb-3d-top.jpg]

[http://gruvin9x.googlecode.com/svn/wiki/PCB.attach/kicad-pcb-3d-bottom.jpg]